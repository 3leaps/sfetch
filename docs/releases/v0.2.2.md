# sfetch v0.2.2 Release Notes

## Summary
Smart asset selection (Phase 1) eliminates the need for `--asset-match` or `--asset-regex` for most repos, plus expanded checksum discovery for non-standard naming patterns like yt-dlp's `SHA2-256SUMS`.

## Highlights

- **Smart asset selection (Phase 1)**
  - Rule-driven tie-breaking: no more "multiple assets tie" errors for common repos.
  - Platform exclusions: `.exe` filtered out on darwin/linux automatically.
  - Case-insensitive matching: `macOS`, `Darwin`, `MACOS` all match darwin platform.
  - Raw-over-archive preference: `yt-dlp_macos` preferred over `yt-dlp_macos.zip`.
  - Schema-validated rules: `schemas/inference-rules.schema.json` + embedded `inference-rules.json`.

- **Expanded checksum/signature discovery**
  - Added `SHA2-256SUMS`, `SHA2-512SUMS`, `SHA512SUMS` patterns.
  - Signature variants: `.minisig`, `.asc`, `.sig` for all checksum file patterns.
  - Supports repos like yt-dlp without requiring `--insecure`.

- **Heuristic `.sig` handling**
  - Checksum-level `.sig` files (e.g., `SHA2-256SUMS.sig`) treated as PGP signatures.
  - Per-asset `.sig` files remain ed25519.
  - Enables GPG verification for repos using binary detached signatures.

- **Dual-hash release signing**
  - sfetch releases now include both `SHA256SUMS` and `SHA2-512SUMS`.
  - Both signed with minisign (primary) and PGP.

- **Secure self-update workflow**
  - New flags: `--self-update`, `--self-update-force`, `--self-update-dir`.
  - Uses existing verification pipeline for security.
  - Major-version guard prevents accidental breaking changes.
  - Windows lock handling with `.new` file fallback.
  - Custom install directory support.

## Proof Points

| Repo | Before v0.2.2 | After v0.2.2 |
|------|---------------|--------------|
| yt-dlp/yt-dlp | Tie: `yt-dlp` vs `yt-dlp.exe` | `yt-dlp_macos` (no flags) |
| cli/cli | Tie: case mismatch on `macOS` | `gh_*_macOS_arm64.zip` (no flags) |

## Usage Notes
- Smart selection is automatic; no new flags required.
- Explicit `--asset-match` or `--asset-regex` still work and take precedence.
- Inference rules can be extended in future releases via user config.

## Files
- New: `inference-rules.json`, `schemas/inference-rules.schema.json`
- New: `scripts/cmd/generate-checksums/` (replaces shell script)
- New: `TestIntegrationSelfUpdate` in integration_test.go
- Updated: main.go, main_test.go, signing/upload scripts
- Removed: `scripts/generate-sha256sums.sh`
